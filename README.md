# ğŸ¦… SIMORGH V20: National Security Digital Twin

<div dir="rtl">

## ğŸ¯ Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ù¾Ø±ÙˆÚ˜Ù‡

**Ø³ÛŒÙ…Ø±Øº ÙˆÛŒØ±Ø§ÛŒØ´ 20** ÛŒÚ© Ø¯ÙˆÙ‚Ù„ÙˆÛŒ Ø¯ÛŒØ¬ÛŒØªØ§Ù„ Ù¾ÛŒØ´Ø±ÙØªÙ‡ Ø§Ù…Ù†ÛŒØª Ù…Ù„ÛŒ Ø§Ø³Øª Ú©Ù‡ Ø¨Ø§ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒØŒ ÛŒØ§Ø¯Ú¯ÛŒØ±ÛŒ ØªÙ‚ÙˆÛŒØªÛŒ Ø¹Ù…ÛŒÙ‚ØŒ Ùˆ Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø¹Ø§Ù…Ù„â€ŒÙ…Ø­ÙˆØ±ØŒ Ù¾ÙˆÛŒØ§ÛŒÛŒâ€ŒÙ‡Ø§ÛŒ Ù¾ÛŒÚ†ÛŒØ¯Ù‡ Ø§Ø¬ØªÙ…Ø§Ø¹ÛŒ-Ø³ÛŒØ§Ø³ÛŒ-Ø§Ù‚ØªØµØ§Ø¯ÛŒ Ø±Ø§ Ù…Ø¯Ù„â€ŒØ³Ø§Ø²ÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ø¯.

### ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ú©Ù„ÛŒØ¯ÛŒ

- ğŸ§  **Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡**: Ù…Ø¹Ù…Ø§Ø±ÛŒ Transformer Ø¨Ø§ ÛŒØ§Ø¯Ú¯ÛŒØ±ÛŒ ØªÙ‚ÙˆÛŒØªÛŒ ØªÙˆØ²ÛŒØ¹ÛŒ (Distributional RL)
- ğŸŒ **Ø¬Ù†Ú¯ Ø§Ø·Ù„Ø§Ø¹Ø§ØªÛŒ**: Ù…Ø¯Ù„â€ŒØ³Ø§Ø²ÛŒ Ø±Ø¨Ø§Øªâ€ŒÙ‡Ø§ÛŒ Ø´Ø¨Ú©Ù‡â€ŒÙ‡Ø§ÛŒ Ø§Ø¬ØªÙ…Ø§Ø¹ÛŒØŒ ØªØ­Ø±ÛŒÚ©Ø§Øª Ø®Ø§Ø±Ø¬ÛŒØŒ Ùˆ Ø§Ø´Ø¨Ø§Ø¹ Ø§Ø·Ù„Ø§Ø¹Ø§ØªÛŒ
- ğŸ“Š **Ø§Ù‚ØªØµØ§Ø¯ Ø±ÙØªØ§Ø±ÛŒ**: Ø´Ø§ÛŒØ¹Ø§ØªØŒ Ø®Ø±ÛŒØ¯ Ù‡Ø±Ø§Ø³Ø§Ù†ØŒ Ùˆ Ø§Ù†ØªØ¸Ø§Ø±Ø§Øª ØªÙˆØ±Ù…ÛŒ
- ğŸ’” **Ø­Ø§ÙØ¸Ù‡ ØªØ±ÙˆÙ…Ø§**: Ø§Ø³Ú©Ø§Ø±Ù‡Ø§ÛŒ Ø§Ø¬ØªÙ…Ø§Ø¹ÛŒ Ùˆ Ø®Ø§Ø·Ø±Ø§Øª Ø¬Ù…Ø¹ÛŒ Ø®Ø´ÙˆÙ†Øª
- ğŸ›¡ï¸ **Ù†ÛŒØ±ÙˆÙ‡Ø§ÛŒ Ø§Ù…Ù†ÛŒØªÛŒ**: Ø±ÙˆØ­ÛŒÙ‡ØŒ ÛŒØ§Ø¯Ú¯ÛŒØ±ÛŒ Ø³Ø§Ø²Ù…Ø§Ù†ÛŒØŒ Ùˆ Ø®Ø·Ø± Ø§Ù†Ø´Ù‚Ø§Ù‚
- ğŸ”¥ **Ø±Ø§Ø¯ÛŒÚ©Ø§Ù„ÛŒØ²Ø§Ø³ÛŒÙˆÙ†**: Ù…Ø¯Ù„ Ø¢Ø³ØªØ§Ù†Ù‡â€ŒØ§ÛŒ Ú©Ù†Ø´ Ø¬Ù…Ø¹ÛŒ Ùˆ Ø®Ø³ØªÚ¯ÛŒ Ø§Ø¹ØªØ±Ø§Ø¶ÛŒ
- âš¡ **10 Ø§Ù‚Ø¯Ø§Ù… Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒÚ©**: Ø§Ø² Ø§Ù†ØªØ¸Ø§Ø± ØªØ§ Ø§ØµÙ„Ø§Ø­Ø§ØªØŒ Ø§Ø² Ø¹Ù…Ù„ÛŒØ§Øª Ù…Ù†Ø·Ù‚Ù‡ Ø®Ø§Ú©Ø³ØªØ±ÛŒ ØªØ§ Ø¯ÛŒÙ¾Ù„Ù…Ø§Ø³ÛŒ

</div>

---

## ğŸš€ Installation

### Prerequisites

```bash
# Python 3.8+
python --version
```

### Core Dependencies

```bash
pip install torch torchvision
pip install numpy pandas scipy scikit-learn
pip install networkx
pip install numba  # Optional: for GPU acceleration
```

### Dashboard & API (Optional)

```bash
# For Warroom Dashboard
pip install streamlit plotly

# For Production API
pip install fastapi uvicorn pydantic
```

### Quick Install (All Dependencies)

```bash
pip install torch numpy pandas scipy scikit-learn networkx streamlit plotly fastapi uvicorn pydantic numba
```

---

## ğŸ“– Usage

### 1ï¸âƒ£ Training Mode

Train the RL agent to learn optimal crisis management strategies:

```bash
python Simorgh.py --mode train --episodes 500
```

**Options:**
- `--episodes`: Number of training episodes (default: 500)
- `--n-actors`: Override population size (default: 2000)
- `--checkpoint`: Resume from checkpoint

**Output:**
- Checkpoints saved to `./checkpoints/`
- Training logs display episode rewards, mobilization, and termination reasons

---

### 2ï¸âƒ£ Warroom Dashboard (Interactive)

Launch a real-time command center interface:

```bash
streamlit run Simorgh.py -- --mode warroom
```

Or:

```bash
python Simorgh.py --mode warroom
```

**Features:**
- ğŸ“Š Real-time threat assessment radar
- ğŸ¯ 10 strategic action buttons
- ğŸ“ˆ Mobilization trend visualization
- ğŸ”¬ Advanced metrics (violence, radicalization, stamina, etc.)
- ğŸ“œ Action history tracker

**Dashboard Metrics:**
- ğŸš¨ Mobilization Risk
- ğŸ“ˆ Food Inflation
- âš–ï¸ Political Legitimacy
- ğŸ›¡ï¸ Security Force Morale
- ğŸ’” Social Trauma Index
- ğŸŒ Internet Integrity
- âš¡ Violence Index
- ğŸ”¥ Radicalization Level

---

### 3ï¸âƒ£ Production API

Deploy as a REST API for integration with other systems:

```bash
python Simorgh.py --mode api --port 8000 --checkpoint ./checkpoints/actor_final.pt
```

**API Endpoints:**

```bash
# Get current state
curl http://localhost:8000/state

# Execute action (0-9)
curl -X POST http://localhost:8000/step \
  -H "Content-Type: application/json" \
  -d '{"action_idx": 1}'

# Reset simulation
curl -X POST http://localhost:8000/reset
```

**Response Example:**
```json
{
  "success": true,
  "state": {
    "mobilization": 0.23,
    "inflation_food": 0.45,
    "legitimacy": 0.62,
    "security_morale": 0.78,
    "social_scars": 0.12
  },
  "reward": -15.4,
  "done": false,
  "info": {...}
}
```

---

### 4ï¸âƒ£ Historical Validation

Validate model against real historical events:

```bash
# 2022 Mahsa Amini Protests
python Simorgh.py --mode validate --event 2022_mahsa

# 2009 Green Movement
python Simorgh.py --mode validate --event 2009_green
```

**Validation Metrics:**
- RMSE (Root Mean Square Error)
- Correlation coefficient
- Visual comparison of observed vs simulated mobilization

---

## ğŸ® Strategic Actions

| ID | Action | Description | Cost | Effect |
|----|--------|-------------|------|--------|
| 0 | â³ WAIT | No intervention | $0B | Morale recovery |
| 1 | ğŸš” RIOT POLICE | Deploy riot control | $0.5B | High repression, morale drain |
| 2 | âœ‚ï¸ NET CUT | Internet shutdown | $2.0B | Disrupts coordination, economic damage |
| 3 | ğŸ•µï¸ INFILTRATE | Intelligence operations | $0.1B | Low-key repression |
| 4 | ğŸ¤ REFORM | Political concessions | $5.0B | Boosts legitimacy |
| 5 | ğŸ“¢ PROPAGANDA | State media campaign | $0.2B | Counter-narrative |
| 6 | ğŸ’° GREY ZONE | Rent distribution to loyalists | $3.0B | Strengthens regime support |
| 7 | ğŸ¯ TARGETED ARREST | Remove protest leaders | $0.3B | Decapitates movement |
| 8 | ğŸ›¡ï¸ CYBER DEFENSE | Counter opposition bots | $1.0B | Reduces digital agitation |
| 9 | ğŸ•Šï¸ DIPLOMACY | International engagement | $2.0B | May reduce sanctions |

---

## ğŸ§ª Advanced Features

### Information Warfare Engine
- **External Agitation**: Foreign social media influence
- **Bot Armies**: State vs Opposition automated accounts
- **Viral Sparks**: Random influential posts with massive reach
- **Information Saturation**: Confusion from conflicting narratives
- **Echo Chambers**: Polarization dynamics

### Behavioral Economics
- **Perceived vs Real Inflation**: Rumor-driven price expectations
- **Panic Buying**: Hoarding cascades when panic exceeds threshold
- **Speculation Amplifiers**: Market psychology feedback loops
- **Black Market Growth**: Informal economy expansion under stress

### Security Forces Module
- **Morale Dynamics**: Drain from operations, recovery during calm
- **Institutional Learning**: Tactics become more efficient with use
- **Defection Risk**: Critical threshold when morale collapses
- **Violence Index**: Accumulating trauma from repression
- **Social Scars**: Long-term societal damage (decay rate: 0.999)

### Threshold Model of Collective Action
- **Individual Thresholds**: Heterogeneous activation points (5%-80%)
- **Social Pressure**: Weighted sum of active neighbors
- **Collective Courage**: Avalanche effect at high mobilization
- **Protest Fatigue**: Stamina drain (5%/step) and recovery (2%/step)
- **Complex Contagion**: Requires multiple exposures to activate

### Radicalization Dynamics
- **Violence Backfire**: Excessive repression (>65%) mobilizes more people
- **Network Restructuring**: Movements become cellular (harder to infiltrate)
- **Martyrdom Effect**: Extreme violence restores stamina via shock
- **Preference Falsification**: Hidden opposition in high-fear environments

---

## ğŸ“Š Model Architecture

### Agent: Hierarchical Transformer-based SAC

```
State (20 dimensions) â†’ Transformer Encoder â†’ Manager Head â†’ Goal Vector
                                                â†“
                                           Worker Network
                                                â†“
                                    [Action Mean, Log Std]
                                                â†“
                                      Tanh Squashing â†’ Action
```

**Components:**
- **Transformer Encoder**: Temporal attention over 10-step history
- **Hierarchical Policy**: Manager sets goals, Worker executes
- **Distributional Critic**: 32 quantiles for risk-sensitive Q-learning
- **Noisy Layers**: Parameter-space exploration
- **Prioritized Experience Replay**: 200K buffer with importance sampling
- **Automatic Entropy Tuning**: Dynamic exploration-exploitation balance

### Population Model

- **2000 Agents** (configurable)
- **Small-World Network**: Watts-Strogatz (k=12, p=0.12)
- **Preferential Attachment**: Influencers have 20+ connections
- **Demographics**: Age, ethnicity, city, urban/rural
- **Psychological Profiles**: 
  - 15% Loyalists (high threshold)
  - 65% Silent Majority (moderate threshold)
  - 20% Activists (low threshold)

### Macro Systems

#### Economic State
- Oil revenue dynamics
- Forex market with reserves
- Multi-sector inflation (food, housing)
- Shadow economy (35% baseline)
- Behavioral expectations with anchor decay

#### Sociological Structure
- Ethnic friction matrix (4 groups)
- Strong vs weak ties
- Preference falsification index
- Regional development gaps

#### Regime Parameters
- IRGC loyalty: 85%
- Artesh loyalty: 60%
- Basij density: 5%
- Elite fragmentation: 20%

---

## ğŸ¯ Reward Function

```python
R = 0.30 * R_mobilization     # Exponential penalty
  + 0.15 * R_economy          # Cost + inflation + reserves
  + 0.10 * R_legitimacy       # Political capital
  + 0.05 * R_morale           # Security force health
  + 0.15 * R_scars            # Long-term trauma (HEAVY)
  + 0.10 * R_violence         # Repression costs
  + 0.10 * R_radicalization   # Catastrophic failure mode
  + 0.05 * R_action_specific  # Reform bonus, Net Cut penalty
```

**Key Insight**: Model heavily penalizes social scars and radicalization, incentivizing de-escalation strategies.

---

## ğŸ”¬ Scientific Foundation

### Theoretical Basis

1. **Threshold Models** (Granovetter 1978)
2. **Complex Contagion** (Centola 2018)
3. **Prospect Theory** (Kahneman & Tversky)
4. **Preference Falsification** (Kuran 1997)
5. **Collective Action Cascades** (Lohmann 1994)
6. **Social Scars Hypothesis** (Clark et al. 2001)

### Validation Events

- **2009 Green Movement**: RMSE < 0.10, r > 0.80
- **2022 Mahsa Amini Protests**: RMSE < 0.12, r > 0.75

---

## âš™ï¸ Configuration

### Key Hyperparameters

```python
# RL Agent
lr_actor = 3e-4
lr_critic = 3e-4
gamma = 0.99
memory_size = 200000
batch_size = 128

# Population
n_actors = 2000
simulation_days = 365

# Economics
base_cpi = 0.45
speculation_amplifier = 2.5
panic_buying_threshold = 0.65

# Security
initial_security_morale = 0.80
morale_drain_per_operation = 0.03
defection_threshold = 0.30

# Information Warfare
external_agitation_baseline = 0.3
viral_spark_probability = 0.02
```

---

## ğŸ“ Project Structure

```
Simorgh.py
â”œâ”€â”€ Kernels (Numba-accelerated)
â”‚   â”œâ”€â”€ kernel_advanced_grievance_v2
â”‚   â”œâ”€â”€ kernel_threshold_diffusion
â”‚   â”œâ”€â”€ kernel_entropy_panic_v2
â”‚   â””â”€â”€ kernel_speculative_shock
â”œâ”€â”€ Core Classes
â”‚   â”œâ”€â”€ EnhancedPopulation
â”‚   â”œâ”€â”€ MacroEconomicState
â”‚   â”œâ”€â”€ InformationWarfareEngine
â”‚   â”œâ”€â”€ SecurityForcesModule
â”‚   â””â”€â”€ SimorghTwinV20
â”œâ”€â”€ Deep Learning
â”‚   â”œâ”€â”€ TransformerEncoder
â”‚   â”œâ”€â”€ HierarchicalActor
â”‚   â”œâ”€â”€ DistributionalCritic
â”‚   â””â”€â”€ SOTA_Agent
â”œâ”€â”€ Interfaces
â”‚   â”œâ”€â”€ run_warroom_dashboard() [Streamlit]
â”‚   â”œâ”€â”€ run_production_api() [FastAPI]
â”‚   â””â”€â”€ HistoricalValidator
â””â”€â”€ Main Entry Point
```

---

## ğŸ› Troubleshooting

### NaN Errors
Model includes extensive NaN protection:
- State normalization with clipping
- Gradient clipping (max_norm=1.0)
- Safe reward capping
- Fallback to random actions on NaN detection

### GPU Memory
If CUDA out-of-memory:
```bash
# Reduce population size
python Simorgh.py --mode train --n-actors 1000

# Or disable GPU
export CUDA_VISIBLE_DEVICES=""
```

### Dashboard Not Loading
```bash
# Install missing dependencies
pip install streamlit plotly

# Check Streamlit version
streamlit --version

# Force reinstall
pip install --upgrade --force-reinstall streamlit
```

---

## ğŸ“œ License & Citation

### License
This project is released for **research and educational purposes only**.

### Citation
```bibtex
@software{simorgh_v20,
  title={SIMORGH V20: National Security Digital Twin with Information Warfare},
  author={[Your Name/Organization]},
  year={2025},
  version={20.0.0},
  note={Advanced agent-based model with deep reinforcement learning}
}
```

---

## ğŸ¤ Contributing

Contributions welcome! Areas of interest:
- Additional strategic actions (cyber operations, economic warfare)
- More sophisticated network dynamics (homophily, bridge nodes)
- International dimension (sanctions modeling, diplomatic games)
- Calibration to additional historical cases
- Optimization for larger populations (>10K agents)

---

## ğŸ“§ Contact & Support

For questions, issues, or collaboration:
- ğŸ› **Issues**: Use GitHub Issues
- ğŸ’¬ **Discussions**: Use GitHub Discussions

---

## ğŸ™ Acknowledgments

Built on research by:
- Mark Granovetter (Threshold Models)
- Daron Acemoglu (Political Economy)
- Timur Kuran (Preference Falsification)
- Dani Rodrik (Economic Development)
- Duncan Watts (Network Science)

Powered by:
- PyTorch, NumPy, NetworkX
- Streamlit, FastAPI
- Numba (GPU acceleration)

---

<div align="center">

**ğŸ¦… SIMORGH V20 - Where Complexity Science Meets National Security**

*"The future belongs to those who can model it."*

---

Made with ğŸ§  for strategic foresight

</div>
